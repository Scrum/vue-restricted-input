!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t=t||self).VueRestrictedInput={})}(this,function(t){"use strict";var e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},n=function(t){return t=t||e.navigator.userAgent,/Android/.test(t)},r=function(t){return!(-1===(t=t||navigator.userAgent).indexOf("Chrome")&&-1===t.indexOf("CriOS")||function(t){return-1!==(t=t||navigator.userAgent).indexOf("Edge/")}(t)||function(t){return t=t||e.navigator.userAgent,/SamsungBrowser/i.test(t)}(t))},i=e.navigator&&e.navigator.userAgent,a=/Version\/\d\.\d* Chrome\/\d*\.0\.0\.0/;var o={isIE9:function(t){return-1!==(t=t||navigator.userAgent).indexOf("MSIE 9")},isAndroidChrome:function(t){var e=t||i;return n(e)&&r(e)},isIos:function(t){return t=t||e.navigator.userAgent,/iPhone|iPod|iPad/i.test(t)},isKitKatWebview:function(t){var e=t||i;return n(e)&&a.test(e)},isSamsungBrowser:function(t){return/SamsungBrowser/.test(t=t||i)||function(t){return!r(t)&&t.indexOf("Samsung")>-1}(t)}},s={errors:{PATTERN_MISSING:"A valid pattern must be provided",INVALID_ELEMENT:"A valid HTML input or textarea element must be provided"}},u=function(t){return Boolean(t)&&(t instanceof HTMLInputElement||t instanceof HTMLTextAreaElement)};var p=function(t){var e,n;return{start:e=t.selectionStart,end:n=t.selectionEnd,delta:Math.abs(n-e)}},l=function(t,e,n){document.activeElement===t&&t.setSelectionRange&&t.setSelectionRange(e,n)},f=p,c=function(t){var e=t.currentTarget||t.srcElement,n=f(e),r=0===n.start,i=n.start===e.value.length,a=!0===t.shiftKey;switch(t.key){case void 0:case"Unidentified":case"":break;case"Backspace":return r;case"Del":case"Delete":return i;default:return 1!==t.key.length}switch(t.keyCode){case 9:case 19:case 20:case 27:case 39:case 45:return!0;case 33:case 34:case 35:case 36:case 37:case 38:case 40:return!a;case 8:return r;case 46:return i;default:return!1}},d=function(t){return"Backspace"===t.key||8===t.keyCode},m=/^Del(ete)?$/,h=/[A-Za-z]/,v=/\d/,E=/./,y=/^[A-Za-z0-9\*]$/,_=new RegExp("({{[^}]+}})|(\\s|\\S)","g"),g=new RegExp("^({{[^}]+}})$"),I=new RegExp("{|}","g");function w(t){return function(t){return v.test(t)}(t)?v:function(t){return h.test(t)}(t)?h:E}function L(t){this.setPattern(t)}L.prototype.setPattern=function(t){if("string"!=typeof t)throw new Error("A valid pattern string is required");this.pattern=function(t){var e,n,r,i,a,o,s,u,p=[],l=t.match(_);for(e=0,n=0;n<l.length;n++)if(i=l[n],u=i,g.test(u))for(a=i.replace(I,"").split(""),r=0;r<a.length;r++){if(o=a[r],s=o,!y.test(s))throw new Error("Only alphanumeric or wildcard pattern matchers are allowed");p.push({value:w(o),isPermaChar:!1,index:e++})}else p.push({value:i,isPermaChar:!0,index:e++});return p}(t)},L.prototype.format=function(t){var e,n,r,i=t.value,a=0,o="",s={start:t.selection.start,end:t.selection.end};for(e=0;e<this.pattern.length&&(n=this.pattern[e],r=i[a],!(a>i.length));e++)if(n.isPermaChar)null==r&&o.length!==n.index||(o+=n.value,n.index<=s.start&&s.start++,n.index<=s.end&&s.end++);else for(;a<i.length;a++){if(r=i[a],n.value.test(r)){o+=r,a++;break}n.index<=s.start&&s.start--,n.index<=s.end&&s.end--}return{value:o,selection:s}},L.prototype.unformat=function(t){var e,n,r=t.selection.start,i=t.selection.end,a="";for(e=0;e<this.pattern.length;e++)(n=this.pattern[e]).isPermaChar||null==t.value[e]||!n.value.test(t.value[e])?n.value===t.value[n.index]&&(n.index<t.selection.start&&r--,n.index<t.selection.end&&i--):a+=t.value[e];return{selection:{start:r,end:i},value:a}},L.prototype.simulateDeletion=function(t){var e,n,r=this.unformat.apply(this,arguments),i=r.value,a=r.selection;return Math.abs(r.selection.end-r.selection.start)?(e=a.start,n=a.end):d(t.event)?(e=Math.max(0,a.start-1),n=a.start):(e=a.start,n=Math.min(i.length,a.start+1)),{selection:{start:e,end:e},value:i.substr(0,e)+i.substr(n)}};var b=L,T=p,k=l;function x(t){this.isFormatted=!1,this.inputElement=t.element,this.formatter=new b(t.pattern),this._attachListeners(),this._formatIfNotEmpty()}function P(t){return!t.key&&!t.keyCode}x.prototype.getUnformattedValue=function(t){var e=this.inputElement.value;return(t||this.isFormatted)&&(e=this.formatter.unformat({value:this.inputElement.value,selection:{start:0,end:0}}).value),e},x.prototype._formatIfNotEmpty=function(){this.inputElement.value&&this._reformatInput()},x.prototype.setPattern=function(t){this._unformatInput(),this.formatter=new b(t),this._formatIfNotEmpty()},x.prototype._attachListeners=function(){var t=this;t.inputElement.addEventListener("keydown",function(e){P(e)&&(t.isFormatted=!1),c(e)||t._isDeletion(e)&&t._unformatInput(e)}),t.inputElement.addEventListener("keypress",function(e){P(e)&&(t.isFormatted=!1),c(e)||t._unformatInput(e)}),t.inputElement.addEventListener("keyup",function(e){t._reformatInput(e)}),t.inputElement.addEventListener("input",function(e){(e instanceof CustomEvent||!e.isTrusted)&&(t.isFormatted=!1),t._reformatInput(e)}),t.inputElement.addEventListener("paste",this._pasteEventHandler.bind(this))},x.prototype._isDeletion=function(t){return function(t){return m.test(t.key)||46===t.keyCode}(t)||d(t)},x.prototype._reformatInput=function(){var t,e;this.isFormatted||(this.isFormatted=!0,t=this.inputElement,e=this.formatter.format({selection:T(t),value:t.value}),t.value=e.value,k(t,e.selection.start,e.selection.end),this._afterReformatInput(e))},x.prototype._afterReformatInput=function(){},x.prototype._unformatInput=function(){var t,e,n;this.isFormatted&&(this.isFormatted=!1,t=this.inputElement,n=T(t),e=this.formatter.unformat({selection:n,value:t.value}),t.value=e.value,k(t,e.selection.start,e.selection.end))},x.prototype._prePasteEventHandler=function(t){t.preventDefault()},x.prototype._postPasteEventHandler=function(){this._reformatAfterPaste()},x.prototype._pasteEventHandler=function(t){var n,r,i="";this._prePasteEventHandler(t),this._unformatInput(),t.clipboardData?i=t.clipboardData.getData("Text"):e.clipboardData&&(i=e.clipboardData.getData("Text")),n=T(this.inputElement),(r=this.inputElement.value.split("")).splice(n.start,n.end-n.start,i),r=r.join(""),this.inputElement.value=r,k(this.inputElement,n.start+i.length,n.start+i.length),this._postPasteEventHandler()},x.prototype._reformatAfterPaste=function(){var t=document.createEvent("Event");this._reformatInput(),t.initEvent("input",!0,!0),this.inputElement.dispatchEvent(t)},x.prototype._getStateToFormat=function(){var t=this.inputElement,e=T(t),n={selection:e,value:t.value};return this._stateToFormat?(n=this._stateToFormat,delete this._stateToFormat):e.start===t.value.length&&this.isFormatted&&(n=this.formatter.unformat(n)),n};var A=x,F=p,D=l;function S(t){A.call(this,t)}S.prototype=Object.create(A.prototype),S.prototype.constructor=S,S.prototype.getUnformattedValue=function(){return A.prototype.getUnformattedValue.call(this,!0)},S.prototype._attachListeners=function(){this.inputElement.addEventListener("keydown",this._keydownListener.bind(this)),this.inputElement.addEventListener("input",function(t){var e=t instanceof CustomEvent;e&&(this._stateToFormat={selection:{start:0,end:0},value:this.inputElement.value}),this._formatListener(),e||this._fixLeadingBlankSpaceOnIos()}.bind(this)),this.inputElement.addEventListener("focus",this._formatListener.bind(this)),this.inputElement.addEventListener("paste",this._pasteEventHandler.bind(this))},S.prototype._fixLeadingBlankSpaceOnIos=function(){var t=this.inputElement;""===t.value&&setTimeout(function(){t.value=""},0)},S.prototype._formatListener=function(){var t=this.inputElement,e=this._getStateToFormat(),n=this.formatter.format(e);t.value=n.value,D(t,n.selection.start,n.selection.end)},S.prototype._keydownListener=function(t){c(t)||this._isDeletion(t)&&(this._stateToFormat=this.formatter.simulateDeletion({event:t,selection:F(this.inputElement),value:this.inputElement.value}))};var C=S,H=l;function O(t){A.call(this,t)}O.prototype=Object.create(A.prototype),O.prototype.constructor=O,O.prototype._attachListeners=function(){var t=this;t.inputElement.addEventListener("keydown",function(e){c(e)||t._unformatInput(e)}),t.inputElement.addEventListener("keypress",function(e){c(e)||t._unformatInput(e)}),t.inputElement.addEventListener("keyup",function(e){t._reformatInput(e)}),t.inputElement.addEventListener("input",function(e){t._reformatInput(e)}),t.inputElement.addEventListener("paste",this._pasteEventHandler.bind(this))},O.prototype._prePasteEventHandler=function(){},O.prototype._postPasteEventHandler=function(){setTimeout(this._reformatAfterPaste.bind(this),0)},O.prototype._afterReformatInput=function(t){var e=this.inputElement;setTimeout(function(){var n=t.selection;H(e,n.end,n.end)},0)};var V=O;function M(t){V.call(this,t)}M.prototype=Object.create(V.prototype),M.prototype.constructor=M,M.prototype._reformatInput=function(){setTimeout(function(){V.prototype._reformatInput.call(this)}.bind(this),0)},M.prototype._unformatInput=function(){setTimeout(function(){V.prototype._unformatInput.call(this)}.bind(this),0)};var R=M,N=p,B=l;function U(t){A.call(this,t)}function j(t,e){return{start:t.start+e,end:t.end+e}}U.prototype=Object.create(A.prototype),U.prototype.constructor=U,U.prototype.getUnformattedValue=function(){return A.prototype.getUnformattedValue.call(this,!0)},U.prototype._attachListeners=function(){this.inputElement.addEventListener("keydown",this._keydownListener.bind(this)),this.inputElement.addEventListener("focus",this._format.bind(this)),this.inputElement.addEventListener("paste",this._pasteEventHandler.bind(this))},U.prototype._format=function(){var t=this.inputElement,e=this._getStateToFormat(),n=this.formatter.format(e);t.value=n.value,B(t,n.selection.start,n.selection.end)},U.prototype._keydownListener=function(t){var e,n,r;c(t)||(t.preventDefault(),this._isDeletion(t)?this._stateToFormat=this.formatter.simulateDeletion({event:t,selection:N(this.inputElement),value:this.inputElement.value}):(n=this.inputElement.value,r=N(this.inputElement),e=n.slice(0,r.start)+t.key+n.slice(r.start),r=j(r,1),this._stateToFormat={selection:r,value:e},r.start===e.length&&(this._stateToFormat=this.formatter.unformat(this._stateToFormat))),this._format())},U.prototype._reformatAfterPaste=function(){var t=this.inputElement,e=N(this.inputElement),n=this.formatter.format({selection:e,value:t.value}).value;e=j(e,1),t.value=n,setTimeout(function(){B(t,e.start,e.end)},0)};var K=U;function $(t){this.inputElement=t.element}$.prototype.getUnformattedValue=function(){return this.inputElement.value},$.prototype.setPattern=function(){};var z=$;function G(t){if(!u((t=t||{}).element))throw new Error(s.errors.INVALID_ELEMENT);if(!t.pattern)throw new Error(s.errors.PATTERN_MISSING);G.supportsFormatting()?o.isIos()?this.strategy=new C(t):o.isKitKatWebview()?this.strategy=new R(t):o.isAndroidChrome()?this.strategy=new V(t):o.isIE9()?this.strategy=new K(t):this.strategy=new A(t):this.strategy=new z(t)}G.prototype.getUnformattedValue=function(){return this.strategy.getUnformattedValue()},G.prototype.setPattern=function(t){this.strategy.setPattern(t)},G.supportsFormatting=function(){return!o.isSamsungBrowser()};var W=G,Z={inserted:function(t,e){t.masked=new W({element:t,pattern:e.value})},update:function(t,e){t.masked&&t.masked.setPattern(e.value)}},q=function(t){t.directive("mask",Z)};t.VueRestrictedInputDirective=Z,t.VueRestrictedInputPlugin=q,t.default=q,Object.defineProperty(t,"__esModule",{value:!0})});
